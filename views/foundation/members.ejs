<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/all.min.css">
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/main.css">
    <title>notifications</title>
</head>
<body>
    <main>
         <div class="">
            <div class="row position-relative">
                <div class="col-2 vh-100 position-sticky top-0 end-0 bg-light">
                    <aside class="p-3">
                        <div class="brand fs-3 mb-3 h-text-primary-dark fw-bold">تطوع</div>
                        <ul class="sidebar-link">
                            <li>
                                <a href="./home.html">
                                    <i class="fa-solid fa-house"></i>
                                    الصفحة الرئيسية
                                </a>
                            </li>
                            <li>
                                <a href="./notifications.html">
                                    <i class="fa-solid fa-bell"></i>
                                    الأشعارات
                                </a>
                            </li>
                            <li>
                                <a href="./events.html" class="active-link-sidebar">
                                    <i class="fa-solid fa-handshake-angle"></i>
                                     إدارة الأحداث
                                </a>
                            </li>
                            <li>
                                <a href="./myEvents.html">
                                    <i class="fa-solid fa-people-group"></i>
                                    فريقي التطوعي
                                </a>
                            </li>
                            <li>
                                <a href="./profile.html" >
                                    <i class="fa-solid fa-user"></i>
                                    ملفي الشخصي
                                </a>
                            </li>
                            <li class="mt-4">
                                <a href="./profile.html" class="h-bg-primary-light rounded-pill px-2 py-1">
                                    <i class="fa-solid fa-right-from-bracket"></i>
                                    تسجيل الخروج
                                </a>
                            </li>
                        </ul>
                    </aside>
                </div>
                <div class="col-7">
                    <section class="p-3">
                        <h4 class="fw-bold">إدارة الأعضاء</h4>
                        <hr>
                        <a data-bs-toggle="modal" data-bs-target="#exampleModal" class="btn btn-sm text-white rounded-pill px-2 h-bg-primary-dark h-bg-primary-dark mb-3">
                            أضافة عضو
                            <i class="fa fa-plus"></i>
                        </a>
                        <div class="table-responsive">
                            <table class="table h-text-17 ">
                                <thead>
                                    <tr>
                                        <th scope="col">#</th>
                                        <th scope="col">الصورة</th>
                                        <th scope="col">الأسم</th>
                                        <th scope="col">تفاصيل</th>
                                        <th scope="col">حذف</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% foundationsMember.memberShips.forEach((element,index) => { %>
                                        <tr class="">
                                            <td scope="row"></td>
                                            <td><img src="/<%- element.avatar %>" class="img-fluid rounded-pill" style="width: 40px; height: 40px; object-fit: cover;" alt=""></td>
                                            <td><%- element.fullName %></td>
                                            <td>
                                                <a  href="/foundation/volunteer/<%- element._id %>">
                                                    <i class="fa-solid fa-info-circle"></i>
                                                </a>
                                            </td>
                                            <td>
                                                <a class="text-danger" href="/foundation/members/<%- element._id %>">
                                                    <i class="fa-solid fa-trash-can"></i>                                           
                                                 </a>
                                            </td>
                                        </tr>
                                    <% }) %>

                                </tbody>
                            </table>
                        </div>
                        
                   </section> 
                </div>
                <div class="col-3">
                    <div class="bg-light p-3">
                        <h5 class="fw-bold">
                            <i class="fa-solid fa-filter"></i>
                            فلترة
                        </h5>
                        <hr>
                        <div class="container">
                            <form class="">
                                <div class="">
                                    <div class="mb-3">
                                        <label for="" class="form-label fw-bold h-text-17">
                                            بحث
                                            <i class="fa-solid fa-search"></i>
                                        </label>
                                        <input type="text" name="" id="" class="form-control rounded-pill form-control-sm h-text-17" placeholder="" aria-describedby="helpId"/>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="" class="form-label fw-bold h-text-17">
                                        <i class="fa-solid fa-map-location"></i>
                                        المدينة
                                    </label>
                                    <select class="form-select form-select-sm rounded-pill h-text-17" name="" id="">
                                        <option selected>الكل</option>
                                        <option value="">المكلا</option>
                                        <option value="">سيؤون</option>
                                        <option value="">غيل باوزير</option>
                                    </select>
                                </div>    
                            </form>
                        </div>
                    </div>
                </div>
            </div>
         </div>
    </main>
    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header align-items-center">
                <input id="userSearchInput" type="text" style="width: 383px;" name="" id="serchMember" class="form-control rounded-pill form-control-sm h-text-17" placeholder="بحث...." aria-describedby="helpId"/>
            <button  type="button" class="btn-close ms-0" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="users-container">
                    
                </div>
            </div>
        </div>
        </div>
    </div>    
    <script src="/js/bootstrap.bundle.min.js"></script>
    <script>
        const userSearchContainer = document.getElementById("users-container");
        const userSearchInput = document.getElementById("userSearchInput");

        userSearchInput.addEventListener("input",async()=>{
            userSearchContainer.innerHTML = "";
            const response = await fetch(`http://localhost:3000/volunteer/search?username=${userSearchInput.value}`)
            const data = await response.json();
            data.data.forEach(element => {
                const template = `
                <div class="p-3 d-flex justify-content-between align-items-center mb-2">
                        <a href="/foundation/volunteer/${element._id}" class="text-decoration-none">
                            <div class="d-flex justify-content-between align-items-center">
                                <img src="/${element.avatar}" style="width: 60px; height: 60px; object-fit: cover;" class="img-fluid rounded-pill" >
                                <p class="fw-semibold m-0 me-3 text-dark">${element.username}</p>
                            </div>
                        </a>
                        <button onclick="invitation('${element._id}')"  class="btn btn-sm  rounded-pill h-btn-primary text-white h-bg-primary-dark" id="${element._id}">دعوة</button>
                    </div>`
                userSearchContainer.innerHTML +=template;
                
            });

            if(userSearchInput.value == "") userSearchContainer.innerHTML =""
           
        })

        function invitation(id){
            const invitationBtn =  document.getElementById(id);
            fetch("/foundation/invitation/invite",{
                method:"POST",
                headers: {'Content-Type': 'application/json'},
                body:JSON.stringify({volunteerId:id})
            }).then(res=>{
                if(res.ok){
                    invitationBtn.classList.add("disabled");
                }
            })

        }

    </script>
</body>
</html>