<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/all.min.css">
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/eventInfo.css">
    <title>notifications</title>
</head>
<body>
    <main>
         <div>
            <div class="row position-relative">
                <div class="col-2 vh-100 position-sticky top-0 end-0 bg-light">
                    <aside class="p-3">
                        <div class="brand fs-3 mb-3 h-text-primary-dark fw-bold">تطوع</div>
                        <ul class="sidebar-link">
                            <li>
                                <a href="./home.html">
                                    <i class="fa-solid fa-house"></i>
                                    الصفحة الرئيسية
                                </a>
                            </li>
                            <li>
                                <a href="./notifications.html">
                                    <i class="fa-solid fa-bell"></i>
                                    الأشعارات
                                </a>
                            </li>
                            <li>
                                <a href="./events.html" class="active-link-sidebar">
                                    <i class="fa-solid fa-handshake-angle"></i>
                                     إدارة الأحداث
                                </a>
                            </li>
                            <li>
                                <a href="./myEvents.html">
                                    <i class="fa-solid fa-people-group"></i>
                                    فريقي التطوعي
                                </a>
                            </li>
                            <li>
                                <a href="./profile.html" >
                                    <i class="fa-solid fa-user"></i>
                                    ملفي الشخصي
                                </a>
                            </li>
                            <li>
                                
                            </li>
                            <li class="mt-4">
                                <a href="./profile.html" class="h-bg-primary-light rounded-pill px-2 py-1">
                                    <i class="fa-solid fa-right-from-bracket"></i>
                                    تسجيل الخروج
                                </a>
                            </li>
                        </ul>
                    </aside>
                </div>
                <div class="col-7">
                    <section class="p-3">
                        <h4 class="fw-bold">الغاء الحدث</h4>
                        <hr>
                        <a href="/foundation/events" class="backBtn btn h-btn-primary d-flex justify-content-center align-items-center">
                            <i class="fa-solid fa-arrow-right"></i>
                        </a>
                        <section id="event-info" class="mt-3">
                            <img src="/<%- data.image %>" class="img-fluid mb-3" alt="">
                            <div class="row">
                                <div class="col-4">
                                    <table class="table h-text-15">
                                        <thead>
                                          <tr>
                                            <th scope="col">العنوان</th>
                                            <th scope="col">التفصيل</th>
                                          </tr>
                                        </thead>
                                        <tbody>
                                          <tr>
                                            <td>العنوان:</td>
                                            <td><%- data.title %></td>
                                          </tr>
                                          <tr>
                                            <td>الجنس:</td>
                                            <td><%- data.gender %></td>
                                          </tr>
                                          <tr>
                                            <td>المدينة:</td>
                                            <td><%- data.city %></td>
                                          </tr>
                                          <tr>
                                            <td>العدد المطلوب:</td>
                                            <td><%- data.volunteersNumber %></td>
                                          </tr>
                                          <tr>
                                            <td>العدد الحالي:</td>
                                            <td><%- data.volunteers.length %></td>
                                          </tr>

                                          <tr>
                                            <td>بداية الحدث:</td>
                                            <td><%-  data.startDate.toLocaleString().slice(0,9) %></td>
                                          </tr>

                                          <tr>
                                            <td>نهاية الحدث:</td>
                                            <td><%- data.endDate.toLocaleString().slice(0,9) %></td>
                                          </tr>

                                          <tr>
                                            <td>حالة الحدث:</td>
                                            <td><% if ( Date.now() < new Date(data.startDate).getTime() ) { %>
                                                    <span class="text-primary fw-bold">تجميع الاعضاء</span>
                                                <% } else if ( Date.now() > new Date(data.startDate).getTime() && Date.now() < new Date(data.endDate).getTime() ) { %>
                                                    <span class="h-text-primary-dark fw-bold">جاري</span>
                                                <% } else { %>
                                                    <span class="text-danger fw-bold">أنتهاء</span>
                                                <% } %>
                                            </td>
                                          </tr>

                                        </tbody>
                                      </table>
                                </div>
                                <div class="col-8">
                                    <iframe src="<%- data.googleMapUrl %>" width="100%" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>                                </div>
                                </div>
                            <div class="">
                                <h5 class="fw-bold">الوصف:</h5>
                                <p class="h-text-17">
                                    <%- data.description %>
                                </p>
                            </div>
                            <button id="deleteBtn" userId="<%- data._id %>" class="my-3 btn btn-sm rounded-pill px-3 btn-danger">
                                الغاء الحدث
                            </button>
                        </section>
                    </section>
                </div>
                <div class="col-3 p-2 mt-3">
                    <h6 class="fw-bold">
                        <i class="fa-solid fa-people-group"></i>
                        المتطوعين
                    </h6>
                    <hr>
                        <div class="mb-3 px-3">
                            <label for="" class="form-label  fw-bold h-text-17">
                                بحث
                                <i class="fa-solid fa-search"></i>
                            </label>
                            <input type="text" name="" id="" class="form-control rounded-pill form-control-sm h-text-17" placeholder="بحث" aria-describedby="helpId"/>
                        </div>
                    <div id="members" class="container h-50 overflow-auto">
                        <% data.volunteers.forEach(element => { %>
                            <a href="/foundation/volunteers/<% data._id %>" class="text-decoration-none text-dark">
                                <div class="d-flex bg-light mb-2 p-2 rounded-pill align-items-center justify-content-satrt">
                                    <div class="d-flex align-items-center">
                                        <img src="/<% data.avatar %>" alt="">
                                        <p class="h-text-15 fw-bold m-0 me-1"><% data.username %></p>
                                    </div>
                                </div>
                            </a>
                        <% }) %>
                        
                       
                    </div>
                </div>
            </div>
         </div>
    </main>
    <div></div>
    
    <script src="/public/js/bootstrap.bundle.min.js"></script>
    <script>
        const deleteBtn = document.getElementById("deleteBtn")
        deleteBtn.addEventListener("click",()=>{
            const id  =  deleteBtn.getAttribute("userId")
            fetch(`/foundation/events/delete`,{
                method:"POST",
                headers:{
                    "Content-Type":"application/json"
                },
                body:JSON.stringify({id})
            })
            .then((res)=>{
                if(res.ok){
                    document.location.assign("/foundation/events");
                }
            }).catch(e=>{
                alert(e)
            })
        })
    </script>
</body>
</html>