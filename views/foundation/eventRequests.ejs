<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/all.min.css">
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/notifications.css">
    <title>notifications</title>
</head>
<body>
    <main>
         <div class="">
            <div class="row position-relative">
                <div class="col-2 vh-100 position-sticky top-0 end-0 bg-light">
                    <aside class="p-3">
                        <div class="brand fs-3 mb-3 h-text-primary-dark fw-bold">تطوع</div>
                        <ul class="sidebar-link">
                            <li>
                                <a href="./home.html">
                                    <i class="fa-solid fa-house"></i>
                                    الصفحة الرئيسية
                                </a>
                            </li>
                            <li>
                                <a href="./notifications.html">
                                    <i class="fa-solid fa-bell"></i>
                                    الأشعارات
                                </a>
                            </li>
                            <li>
                                <a href="./events.html" class="active-link-sidebar">
                                    <i class="fa-solid fa-handshake-angle"></i>
                                     إدارة الأحداث
                                </a>
                            </li>
                            <li>
                                <a href="./myEvents.html">
                                    <i class="fa-solid fa-people-group"></i>
                                    فريقي التطوعي
                                </a>
                            </li>
                            <li>
                                <a href="./profile.html" >
                                    <i class="fa-solid fa-user"></i>
                                    ملفي الشخصي
                                </a>
                            </li>
                            <li>
                                
                            </li>
                            <li class="mt-4">
                                <a href="./profile.html" class="h-bg-primary-light rounded-pill px-2 py-1">
                                    <i class="fa-solid fa-right-from-bracket"></i>
                                    تسجيل الخروج
                                </a>
                            </li>
                        </ul>
                    </aside>
                </div>
                <div class="col-7">
                    <section class="p-2">
                        <h4 class="fw-bold">الأشعارات</h4>
                        <hr>
                        <section id="notificationsInfo" class="mt-5">
                            <div class="container">
                                <% data.forEach(element => { %>
                                    <div id="eventRequest-msg" class="card mb-2 p-3">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <img src="/<%-  element.volunteer.avatar %>" class="img-fluid" alt="">
                                            <span class="h-bg-primary-light h-text-13 fw-bold mt-1 p-1 rounded-pill">طلب الأنضمام</span>
                                        </div>
                                        <p class="mt-2 h-text-17">
                                            <a  href="/foundation/volunteer/<%- element.volunteer._id %>" class="h-text-primary-dark text-decoration-none">@<%- element.volunteer.username %></a> طلب الأنضمام الئ حدث <a href="/foundation/events/<%- element.event._id %>" class="h-text-primary-dark text-decoration-none"><%- element.event.title %></a>
                                        </p>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <button type="button" eventId="<%- element.event._id %>"  requestId="<%- element._id %>" status="1" volunteerId="<%- element.volunteer._id %>" class="actionBtn btn h-text-14 rounded-pill h-btn-primary px-3 h-bg-primary-dark text-white btn-sm">
                                                    إنضمام
                                                </button>
                                                <button type="button" eventId="<%- element.event._id %>"  requestId="<%- element._id %>" status="2" volunteerId="<%- element.volunteer._id %>" class="actionBtn btn h-text-14 text-dark rounded-pill  h-btn-primary-outline btn-sm">
                                                    رفض
                                                </button>
                                            </div>
                                            <span class="text-secondary h-text-16 fw-semibold "><%- element.createdAt.toISOString().split("T")[0] %></span>
                                        </div>
                                    </div>
                                    
                                <% }) %>
                               
                            </div>
                        </section>
                    </section>
                </div>
                <div class="col-3">
                    <div class="bg-light p-3">
                        <h5 class="fw-bold">
                            <i class="fa-solid fa-filter"></i>
                            فلترة
                        </h5>
                        <hr>
                        <div class="container">
                            <form class=""> 
                                <div class="mb-3">
                                    <label for="" class="form-label fw-bold h-text-17">
                                        <i class="fa-solid fa-calendar"></i>
                                        تاريخ
                                    </label>
                                    <input type="date" class="form-control rounded-pill form-control-sm" name="" id="" aria-describedby="helpId" placeholder="" />
                                </div> 
                                <div class="mb-3">
                                    <label for="" class="form-label fw-bold h-text-17">
                                        <i class="fa-solid fa-handshake-angle"></i>
                                        الحدث
                                    </label>
                                    <select class="form-select form-select-sm rounded-pill h-text-17" name="" id="">
                                        <option selected>الكل</option>
                                        <option value="">تنظيف الشاطئ</option>
                                        <option value="">كسوة العيد</option>
                                    </select>
                                </div>  
                            </form>
                        </div>
                    </div>
                </div>
            </div>
         </div>
    </main>
    <div></div>
    
    <script src="/js/bootstrap.bundle.min.js"></script>
    <script>
        const actionBtns = document.querySelectorAll(".actionBtn")

        actionBtns.forEach(btn=>{
            btn.addEventListener("click",()=>{
                const status = btn.getAttribute("status");
                const volunteerId = btn.getAttribute("volunteerId");
                const requestId = btn.getAttribute("requestId") ;
                const eventId = btn.getAttribute("eventId") ;
                fetch("/foundation/requests/foundationAction",{
                    method:"POST",
                    headers:{
                        "Content-Type":"application/json"
                    },
                    body:JSON.stringify({status,volunteerId,requestId,eventId})
                }).then((res)=>{
                    if(res.ok){
                        document.location.reload();
                    }
                }).catch(e=>{
                    alert(e);
                })
            })
        })

    </script>
</body>
</html>