<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/all.min.css">
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/eventInfo.css">
    <title>دعوة الاعضاء</title>
</head>
<body>
    <main>
         <div class="">
            <div class="row position-relative">
                <div class="col-2 vh-100 position-sticky top-0 end-0 bg-light">
                    <%- include('../part/sidebar2.ejs') %>
                </div>
                <div class="col-7">
                    <section class="p-3">
                        <h4 class="fw-bold">دعوة الأعضاء</h4>
                        <hr>
                        <a href="/foundation/events" class="backBtn btn h-btn-primary d-flex justify-content-center align-items-center">
                            <i class="fa-solid fa-arrow-right"></i>
                        </a>

                        <section class="m-2 mt-4">
                            <% data.forEach(element => { %>
                                <div class="d-flex bg-light mb-2 px-3 py-2 rounded-pill justify-content-between align-items-center w-50 ">

                                    <a class="text-decoration-none d-flex  justify-content-between align-items-center text-dark" href="/foundation/volunteer/<%- element._id %>">
                                        <img src="/<%- element.avatar %>" style="width: 70px; height: 70px; object-fit: cover;" class="img-fluid rounded-pill ms-3" alt="">
                                        <h6  class="fw-semibold"><%- element.username %></h6>
                                    </a>
                                    <button  userId="<%- element._id %>" class="inviteBtns btn btn-sm h-btn-primary h-text-14 px-3 h-bg-primary-dark rounded-pill text-white">دعوة</button>
                                </div>
                            <% }) %>
                        
                        </section>
                        
                    </section>
                </div>
             
            </div>
         </div>
    </main>
    <div></div>
    
    <script src="/js/bootstrap.bundle.min.js"></script>
    <script>

        const inviteBtns = document.querySelectorAll(".inviteBtns");
        const pathname = document.location.pathname.split("/");
        const eventId = pathname[pathname.length - 1]; 
            
      

        inviteBtns.forEach(btn=>{
            btn.addEventListener("click",()=>{
                const volunteerId = btn.getAttribute("userId");
                if(btn.innerHTML == "دعوة"){
                    fetch("/foundation/events/invite",{
                        method:"POST",
                        headers:{
                            "Content-Type":"application/json"
                        },
                        body:JSON.stringify({
                            volunteerId,
                            eventId
                        })
                    }).then((res)=>{
                        if(res.ok){
                            btn.classList.remove("h-bg-primary-dark");
                            btn.classList.add("bg-secondary");
                            btn.innerHTML = "دعوة "
                        }
                    }).catch(e=>{
                        console.log(e);
                    })
                
                }
            })
        })
    </script>
</body>
</html>